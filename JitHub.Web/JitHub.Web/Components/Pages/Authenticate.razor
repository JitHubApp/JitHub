@page "/authenticate"
@using Octokit
@using System.Collections.ObjectModel
@inject IConfiguration Configuration

<h3>Authenticate</h3>

@if(oauthLoginUrl is not null)
{
    <RedirectToGitHub OauthLoginUrl="oauthLoginUrl"/>
}

@code {
    private Uri? oauthLoginUrl;

    [SupplyParameterFromQuery]
    public string? Scopes { get; set; }

    protected override void OnInitialized()
    {
        string clientId = Configuration["JithubClientId"];
        OauthLoginRequest request = new OauthLoginRequest(clientId);
        Collection<string> scopes = new();
        foreach (var scope in Scopes?.Split(':'))
        {
            request.Scopes.Add(scope);
        }

        var github = new GitHubClient(new ProductHeaderValue("JitHubV3"));
        oauthLoginUrl = github.Oauth.GetGitHubLoginUrl(request);
    }
}
